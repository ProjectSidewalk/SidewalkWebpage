@import models.user.User
@import models.daos.slick.DBTableDefinitions.DBUser
@import models.audit.AuditTaskCommentTable
@import models.audit.AuditTaskTable
@import models.user.UserRoleTable
@import models.user.TeamTable
@import models.user.UserTeamTable
@import models.mission.MissionTable
@import models.label.LabelTable
@import models.label.LabelValidationTable

@import java.util.UUID
@import models.user.UserCurrentRegionTable

@import models.region.RegionTable
@import models.audit.AuditTaskInteractionTable
@(title: String, user: Option[User] = None, userDB: Option[DBUser] = None, admin: Option[User] = None, auditedDistance: Float)(implicit lang: Lang)
@userTeam = @{UserTeamTable.getTeam(user.get.userId)}
@teamName = @{userTeam.flatMap(teamId => TeamTable.getTeamName(teamId)).getOrElse("Team name not found")}
@teamFound = @{userTeam.flatMap(teamId => TeamTable.getTeam(teamId))}

@main(title) {
    @if(admin.isDefined) {
        @navbar(admin)
    } else {
        @navbar(user, user.map(u=> "/dashboard"))
    }
    <div class="container">

        @if(!admin.isDefined) {
            @if(user && user.get.role.getOrElse("") != "Anonymous") {
                <div class="row" id="profile-container">
                    <div id="username">@user.get.username</div>
                    <div id="org-container">
                        <div id="edit-org-dropdown" class="dropdown">
                            <a id="edit-org-button" role="button" data-toggle="dropdown" href="#">
                                @if(userTeam.isDefined) {
                                    @Messages("dashboard.current.team.greeting", teamName) <b class="caret"></b>
                                } else {
                                    @Messages("dashboard.join.team") <b class="caret"></b>
                                }
                            </a>
                            <ul id="edit-org-menu" class="dropdown-menu" role="menu">
                                @if(userTeam.isDefined) {
                                    <li>
                                        <a id="from-@userTeam.getOrElse(0)-to-0" role="menuitem" class="put-user-org">
                                            <strong>@Messages("dashboard.leave.team", teamName)</strong>
                                        </a>
                                    </li>
                                }
                                <li>
                                    <a id="create-org-button" role="menuitem" class="create-org" data-toggle="modal" data-target="#create-team-modal" href="#"><strong>@Messages("dashboard.create.team")</strong></a>
                                </li>
                                @for(team <- TeamTable.getAllTeams) {
                                    @if(team.teamId!= userTeam.getOrElse(-1)){
                                        <li class="put-org-container" data-toggle="popover" data-container="body" data-trigger="hover" data-placement="right" data-content="@team.description">
                                            <a id="from-@userTeam.getOrElse(0)-to-@team.teamId" role="menuitem" class="put-user-org">@team.name</a>
                                        </li>
                                    }
                                }
                            </ul>
                        </div>
                    </div>
                </div>
            }

            <div class="modal fade" id="create-team-modal" tabindex="-1" role="dialog" aria-labelledby="create-team-modal-label" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="create-team-modal-label">@Messages("dashboard.team.title")</h5>
                            <button type="button" class="close custom-close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="create-team-form">
                                <div class="form-group">
                                    <label for="team-name-input">@Messages("dashboard.team.name")</label>
                                    <input type="text" class="form-control" id="team-name-input" required>
                                </div>
                                <div class="form-group">
                                    <label for="team-description-input">@Messages("dashboard.team.description")</label>
                                    <textarea class="form-control" id="team-description-input" required></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">@Messages("cancel")</button>
                            <button type="button" class="btn btn-primary" id="save-team-button">@Messages("dashboard.team.button")</button>
                        </div>
                    </div>
                </div>
            </div>        
        }

        <div class="row" id="map-row">
            <div class="col-lg-12" id="map-column">
                <div id="user-dashboard-choropleth-holder" class="choropleth-holder">
                    <div id="user-dashboard-choropleth" class="choropleth"></div>
                    <div id="map-label-legend">
                        <table class="table legend">
                            <tr>
                                <td id="map-legend-curb-ramp" class="map-legend-circle-icon"><svg><circle r='6'/></svg></td>
                                <td>@Messages("curb.ramp")</td><td id="td-number-of-curb-ramps"></td>
                            </tr>
                            <tr>
                                <td id="map-legend-no-curb-ramp" class="map-legend-circle-icon"><svg><circle r='6'/></svg></td>
                                <td>@Messages("missing.ramp")</td><td id="td-number-of-missing-curb-ramps"></td>
                            </tr>
                            <tr>
                                <td id="map-legend-obstacle" class="map-legend-circle-icon"><svg><circle r='6'/></svg></td>
                                <td>@Messages("obstacle")</td><td id="td-number-of-obstacles"></td>
                            </tr>
                            <tr>
                                <td id="map-legend-surface-problem" class="map-legend-circle-icon"><svg><circle r='6'/></svg></td>
                                <td>@Messages("surface.problem")</td><td id="td-number-of-surface-problems"></td>
                            </tr>
                            <tr>
                                <td id="map-legend-no-sidewalk" class="map-legend-circle-icon"><svg><circle r='6'/></svg></td>
                                <td>@Messages("no.sidewalk")</td><td id="td-number-of-no-sidewalks"></td>
                            </tr>
                            <tr>
                                <td id="map-legend-crosswalk" class="map-legend-circle-icon"><svg><circle r='6'/></svg></td>
                                <td>@Messages("crosswalk")</td><td id="td-number-of-crosswalks"></td>
                            </tr>
                            <tr>
                                <td id="map-legend-signal" class="map-legend-circle-icon"><svg><circle r='6'/></svg></td>
                                <td>@Messages("signal")</td><td id="td-number-of-signals"></td>
                            </tr>
                            <tr>
                                <td id="map-legend-audited-street"><svg><path d="M 2 10 L 18 10 z"></path></svg></td>
                                <td>@Messages("audited.street")</td>
                            </tr>
                            <tr>
                                <td id="map-legend-correct"><img src='@routes.Assets.at("javascripts/SVValidate/img/Checkmark.png")'></td>
                                <td>@Messages("validated.correct")</td>
                                <td><input type="checkbox" id="correct" checked="true" data-filter-type="label-validations" disabled></td>
                            </tr>
                            <tr>
                                <td id="map-legend-incorrect"><img src='@routes.Assets.at("javascripts/SVValidate/img/Cross.png")'></td>
                                <td>@Messages("validated.incorrect")</td>
                                <td><input type="checkbox" id="incorrect" checked="true" data-filter-type="label-validations" disabled></td>
                            </tr>
                            <tr>
                                <td id="map-legend-unsure"><img src='@routes.Assets.at("images/icons/QuestionMark.png")'></td>
                                <td>@Messages("unsure.caps")</td>
                                <td><input type="checkbox" id="unsure" checked="true" data-filter-type="label-validations" disabled></td>
                            </tr>
                            <tr>
                                <td id="map-legend-unvalidated"><img src='@routes.Assets.at("images/icons/ExclamationMark.png")'></td>
                                <td>@Messages("unvalidated")</td>
                                <td><input type="checkbox" id="unvalidated" checked="true" data-filter-type="label-validations" disabled></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        @if(!admin.isDefined) {
            <div class="row" style="margin-top: 30px">
                <div class="user-stats-holder">
                    <span class="user-stats-header">@Messages("dashboard.your.missions")</span>
                    <span class="user-stats-header">@Messages("dashboard.distance")</span>
                    <span class="user-stats-header">@Messages("dashboard.labels")</span>
                    <span class="user-stats-header">@Messages("validations")</span>
                    <span class="user-stats-header">@Messages("accuracy.caps")</span>

                    <img src='@routes.Assets.at("images/icons/project_sidewalk_flag.png")' alt="@Messages("dashboard.mission.icon.alt")"/>
                    <img src='@routes.Assets.at("images/icons/noun_distance_2587675_cropped.png")' alt="@Messages("distance.icon.alt")"/>
                    <img src='@routes.Assets.at("images/icons/noun_pin_location_2342268_cropped.png")' alt="@Messages("label.icon.alt")"/>
                    <img src='@routes.Assets.at("images/icons/noun_validation_1876484_cropped.png")' alt="@Messages("dashboard.validation.icon.alt")"/>
                    <img src='@routes.Assets.at("images/icons/noun_target_3485590_cropped.png")' alt="@Messages("accuracy.icon.alt")" title="@Messages("dashboard.accuracy.icon.tooltip")"/>

                    <span class="user-stats-stat">@MissionTable.countCompletedMissions(user.get.userId, true, false)</span>
                    <span class="user-stats-stat">@{s"%.2f ${Messages("dist.metric.abbr")}".format(auditedDistance)}</span>
                    <span class="user-stats-stat">@LabelTable.countLabels(user.get.userId)</span>
                    <span class="user-stats-stat">@LabelValidationTable.countValidations(user.get.userId)</span>
                    <span class="user-stats-stat">@LabelValidationTable.getUserAccuracy(user.get.userId).map(a => "%.1f%%".format(a * 100)).getOrElse("N/A")</span>

                </div>
            </div>

            @* Only show this table if the current user is a turker *@
            @if(user && user.get.role.getOrElse("") == "Turker") {
                <div class="row" style="margin-top: 20px">
                    <table class="table table-striped table-condensed">
                        <tr>
                            <th>@Messages("turk.reward.earned")</th>
                        </tr>
                        <tr>
                            <td id="td-total-reward-earned"></td>
                        </tr>
                    </table>
                </div>
            }

            <div class="row" id="achievements">
                <h2 id="achievements">@Messages("dashboard.achievements")</h2>
                <!-- The achievements-outer-grid is 3 columns -->
                <div class="achievements-outer-grid">
                    <div class="achievements-outer-col1">
                        <h3>@Messages("dashboard.missions")</h3>
                        <p id="missions-badge-encouragement" class="achievements-encouraging-statement">Just XX more missions until your next mission achievement.</p>
                        <div id="missions-badge-grid" class="achievements-badge-grid">
                            <img id="missions-badge1" src='@routes.Assets.at("images/badges/badge_missions_badge1.png")' alt="@Messages("dashboard.mission.badge", Messages("dashboard.first"))">
                            <img id="missions-badge2" src='@routes.Assets.at("images/badges/badge_missions_badge2.png")' alt="@Messages("dashboard.mission.badge", Messages("dashboard.second"))">
                            <img id="missions-badge3" src='@routes.Assets.at("images/badges/badge_missions_badge3.png")' alt="@Messages("dashboard.mission.badge", Messages("dashboard.third"))">
                            <img id="missions-badge4" src='@routes.Assets.at("images/badges/badge_missions_badge4.png")' alt="@Messages("dashboard.mission.badge", Messages("dashboard.fourth"))">
                            <img id="missions-badge5" src='@routes.Assets.at("images/badges/badge_missions_badge5.png")' alt="@Messages("dashboard.mission.badge", Messages("dashboard.fifth"))">
                        </div>
                    </div>
                    <div class="achievements-outer-col2"><!--Empty middle cell in outer grid--></div>
                    <div class="achievements-outer-col3">
                        <h3>@Messages("dashboard.distance")</h3>
                        <p id="distance-badge-encouragement" class="achievements-encouraging-statement">Just XX more miles until your next distance achievement.</p>
                        <div id="distance-badge-grid" class="achievements-badge-grid">
                            @if(Messages("measurement.system") == "metric") {
                                <img id="distance-badge1" src='@routes.Assets.at("images/badges/badge_distance_km_badge1.png")' alt="@Messages("dashboard.distance.badge", Messages("dashboard.first"))">
                                <img id="distance-badge2" src='@routes.Assets.at("images/badges/badge_distance_km_badge2.png")' alt="@Messages("dashboard.distance.badge", Messages("dashboard.second"))">
                                <img id="distance-badge3" src='@routes.Assets.at("images/badges/badge_distance_km_badge3.png")' alt="@Messages("dashboard.distance.badge", Messages("dashboard.third"))">
                                <img id="distance-badge4" src='@routes.Assets.at("images/badges/badge_distance_km_badge4.png")' alt="@Messages("dashboard.distance.badge", Messages("dashboard.fourth"))">
                                <img id="distance-badge5" src='@routes.Assets.at("images/badges/badge_distance_km_badge5.png")' alt="@Messages("dashboard.distance.badge", Messages("dashboard.fifth"))">
                            } else {
                                <img id="distance-badge1" src='@routes.Assets.at("images/badges/badge_distance_badge1.png")' alt="@Messages("dashboard.distance.badge", Messages("dashboard.first"))">
                                <img id="distance-badge2" src='@routes.Assets.at("images/badges/badge_distance_badge2.png")' alt="@Messages("dashboard.distance.badge", Messages("dashboard.second"))">
                                <img id="distance-badge3" src='@routes.Assets.at("images/badges/badge_distance_badge3.png")' alt="@Messages("dashboard.distance.badge", Messages("dashboard.third"))">
                                <img id="distance-badge4" src='@routes.Assets.at("images/badges/badge_distance_badge4.png")' alt="@Messages("dashboard.distance.badge", Messages("dashboard.fourth"))">
                                <img id="distance-badge5" src='@routes.Assets.at("images/badges/badge_distance_badge5.png")' alt="@Messages("dashboard.distance.badge", Messages("dashboard.fifth"))">
                            }
                        </div>
                    </div>

                    <div class="achievements-outer-col1">
                        <h3>@Messages("dashboard.labels")</h3>
                        <p id="labels-badge-encouragement" class="achievements-encouraging-statement">Just XX more labels until your next labeling achievement.</p>
                        <div id="labels-badge-grid" class="achievements-badge-grid">
                            <img id="labels-badge1" src='@routes.Assets.at("images/badges/badge_labels_badge1.png")' alt="@Messages("dashboard.label.badge", Messages("dashboard.first"))">
                            <img id="labels-badge2" src='@routes.Assets.at("images/badges/badge_labels_badge2.png")' alt="@Messages("dashboard.label.badge", Messages("dashboard.second"))">
                            <img id="labels-badge3" src='@routes.Assets.at("images/badges/badge_labels_badge3.png")' alt="@Messages("dashboard.label.badge", Messages("dashboard.third"))">
                            <img id="labels-badge4" src='@routes.Assets.at("images/badges/badge_labels_badge4.png")' alt="@Messages("dashboard.label.badge", Messages("dashboard.fourth"))">
                            <img id="labels-badge5" src='@routes.Assets.at("images/badges/badge_labels_badge5.png")' alt="@Messages("dashboard.label.badge", Messages("dashboard.fifth"))">
                        </div>
                    </div>
                    <div class="achievements-outer-col2"><!--Empty middle cell in outer grid--></div>
                    <div class="achievements-outer-col3">
                        <h3>@Messages("validations")</h3>
                        <p id="validations-badge-encouragement" class="achievements-encouraging-statement">Just XX more validations until your next validation achievement.</p>
                        <div id="validations-badge-grid" class="achievements-badge-grid">
                            <img id="validations-badge1" src='@routes.Assets.at("images/badges/badge_validation_badge1.png")' alt="@Messages("dashboard.validation.badge", Messages("dashboard.first"))">
                            <img id="validations-badge2" src='@routes.Assets.at("images/badges/badge_validation_badge2.png")' alt="@Messages("dashboard.validation.badge", Messages("dashboard.second"))">
                            <img id="validations-badge3" src='@routes.Assets.at("images/badges/badge_validation_badge3.png")' alt="@Messages("dashboard.validation.badge", Messages("dashboard.third"))">
                            <img id="validations-badge4" src='@routes.Assets.at("images/badges/badge_validation_badge4.png")' alt="@Messages("dashboard.validation.badge", Messages("dashboard.fourth"))">
                            <img id="validations-badge5" src='@routes.Assets.at("images/badges/badge_validation_badge5.png")' alt="@Messages("dashboard.validation.badge", Messages("dashboard.fifth"))">
                        </div>
                    </div>
                </div>
            </div>

            <div id="mistakes-row" class="row">
                <h2 id="recent-mistakes">@Messages("dashboard.mistakes.header")</h2>
                <span id="mistakes-subheader-display"></span>
                <img src="@routes.Assets.at("images/icons/QuestionMark.png")" class="mistakes-help-tooltip" data-toggle="tooltip" data-placement="top" title="@Messages("dashboard.mistakes.tooltip")" alt="">
                <div id="mistake-carousels-holder"></div>
            </div>
        </div>
    }
    
    @if(admin.isDefined && userDB.isDefined) {
        <h1>General Info and Stats</h1>
        <div class="row">
            <div class="col-lg-12">
                <table class="table table-striped table-condensed">
                    <tr>
                        <th class="col-md">Username</th>
                        <th class="col-md">User Id</th>
                        <th class="col-md">Email</th>
                        <th class="col-md">Current Neighborhood</th>
                        <th class="col-md">Volunteer</th>
                    </tr>
                    <tr>
                        <td>@userDB.map(_.username).getOrElse("No Username")</td>
                        <td>@userDB.map(_.userId).getOrElse("No ID")</td>
                        <td>@userDB.map(_.email).getOrElse("No Email")</td>
                        <td>
                            @(UserCurrentRegionTable.currentRegion(userDB.map(_.userId).map(UUID.fromString).getOrElse(UUID.randomUUID())).map { x => RegionTable.neighborhoodName(x) }.getOrElse("Unassigned"))
                            (Region ID: @(UserCurrentRegionTable.currentRegion(userDB.map(_.userId).map(UUID.fromString).getOrElse(UUID.randomUUID())).map{x => x}.getOrElse("NA")))
                        </td>
                        <td><input type="checkbox" id="check-volunteer"></td>
                    </tr>
                </table>
            </div>
            <div class="col-lg-12">
                <table class="table table-striped table-condensed">
                    <tr>
                        <th class="col-md">Mission Count</th>
                        <th class="col-md">Audited Street Count</th>
                        <th class="col-md">Label Count</th>
                        <th class="col-md">Total Distance Audited</th>
                        <th class="col-md">Time spent auditing/validating</th>
                    </tr>
                    <tr>
                        <td>@MissionTable.countCompletedMissions(userDB.map(_.userId).map(UUID.fromString).getOrElse(UUID.randomUUID()), includeOnboarding = false, includeSkipped = false)</td>
                        <td>@AuditTaskTable.countCompletedAudits(userDB.map(_.userId).map(UUID.fromString).getOrElse(UUID.randomUUID()))</td>
                        <td>@LabelTable.countLabels(userDB.map(_.userId).map(UUID.fromString).getOrElse(UUID.randomUUID()))</td>
                        <td>@{s"%.2f ${Messages("dist.metric.abbr")}".format(auditedDistance)}</td>
                        <td>@{"%.2f".format(AuditTaskInteractionTable.getHoursAuditingAndValidating(userDB.map(_.userId).getOrElse("No Id")))} hours</td>
                    </tr>
                </table>
            </div>
            <div class="col-lg-12">
            </div>
        </div>

        <h1>Mark Work Quality by Date</h1>
        <p>
            Select a date to mark all labels for this user before that date with the desired flag. This is useful when
            training new users on Project Sidewalk. If their work was low quality, set it as such below. Their labels
            will then be partially hidden in our APIs, and we won't assign other to validate those labels as frequently.
        </p>
        <p>
            If their work was high quality, but they did not use all the available label types or didn't label the
            entire street, you can mark their data as "incomplete". Their labels will show up in our APIs, but we'll
            have other users re-audit those streets.
        </p>
        <div class="row set-flags-container">
            <div class="col-lg-4 flag-date-container">
                <h2>Low Quality</h2>
                <div class="row">
                    <div class="input-group date datepicker" data-date-format="mm-dd-yyyy">
                        <input id="low-quality-date" class="form-control" type="text"/>
                        <span class="input-group-addon">
                            <i class="glyphicon glyphicon-calendar"></i>
                        </span>
                    </div>
                </div>
                <div class="row date-submit-row">
                    <button type="button" class="btn btn-primary date-submit" onclick=setLowQualityDate(true)>Set Flags</button>
                    <button type="button" class="btn btn-primary date-submit" onclick=setLowQualityDate(false)>Remove Flags</button>
                </div>
                <div class="row">
                    <div id="low-quality-alert" class="alert alert-success" role="alert" style="visibility: hidden">Alert TEST</div>
                </div>
            </div>
            <div class="col-lg-4 flag-date-container">
                <h2>Incomplete</h2>
                <div class="row">
                    <div class="input-group date datepicker" data-date-format="mm-dd-yyyy">
                        <input id="incomplete-date" class="form-control" type="text"/>
                        <span class="input-group-addon">
                            <i class="glyphicon glyphicon-calendar"></i>
                        </span>
                    </div>
                </div>
                <div class="row date-submit-row">
                    <button type="button" class="btn btn-primary date-submit" onclick=setIncompleteDate(true)>Set Flags</button>
                    <button type="button" class="btn btn-primary date-submit" onclick=setIncompleteDate(false)>Remove Flags</button>
                </div>
                <div class="row">
                    <div id="incomplete-alert" class="alert alert-success" role="alert" style="visibility: hidden">Alert TEST</div>
                </div>
            </div>
        </div>

        <h1>Completed Missions</h1>
        <div class="row">
            <table class="table table-striped table-fixed">
                <thead>
                    <tr>
                        <th class="col-md-2">Mission Id</th>
                        <th class="col-md-2">Mission Type</th>
                        <th class="col-md-1">Region Id</th>
                        <th class="col-md-2">Region Name</th>
                        <th class="col-md-3">Distance (m / ft / mi)</th>
                        <th class="col-md-2">Labels Verified</th>
                    </tr>
                </thead>
                <tbody>
                @for(mission <- MissionTable.selectCompletedRegionalMission(userDB.map(_.userId).map(UUID.fromString).getOrElse(UUID.randomUUID()))) {
                    <tr>
                        <td class="col-md-2">@mission.missionId</td>
                        <td class="col-md-2">@mission.missionType</td>
                        <td class="col-md-1">@mission.regionId.map(_.toString).getOrElse("N/A")</td>
                        <td class="col-md-2">@mission.regionName.getOrElse("N/A")</td>
                        <td class="col-md-3">@("%1.1f".format(mission.distanceMeters.getOrElse(0F))) / @{"%1.1f".format(mission.distanceMeters.getOrElse(0F) * 3.28084F)} / @{"%1.1f".format(mission.distanceMeters.getOrElse(0F) / 1609.344051499F)}</td>
                        <td class="col-md-2">@mission.labelsValidated.getOrElse(0)</td>
                    </tr>
                }
                </tbody>
            </table>
        </div>

        <h1>Feedback</h1>
        <div class="row">
            <div class="col-lg-12">
                <table class="table table-striped table-condensed">
                    <tr><th class="col-md-3">Timestamp</th><th class="col-md-3">Panorama Id</th><th class="col-md-6">Comment</th></tr>
                    @AuditTaskCommentTable.all(userDB.map(_.username).getOrElse("No Username")).getOrElse(List()).map { comment =>
                        <tr>
                            <td class = 'timestamp'>@comment.timestamp</td>
                            <td>@comment.gsvPanoramaId</td>
                            <td>@comment.comment</td>
                        </tr>
                    }
                </table>
            </div>
        </div>
    }
    
    
    <script type="text/javascript" src='@routes.Assets.at("javascripts/lib/turf-7.1.0.min.js")'></script>
    <script type="text/javascript" src='@routes.Assets.at("javascripts/lib/i18next-23.14.0.min.js")'></script>
    <script type="text/javascript" src='@routes.Assets.at("javascripts/lib/i18nextHttpBackend-2.6.0.min.js")'></script>
    <script src='@routes.Assets.at("javascripts/lib/mapbox-gl-3.6.0.js")'></script>
    <script src='@routes.Assets.at("javascripts/lib/mapbox-gl-language-1.0.1.js")'></script>
    <link href='@routes.Assets.at("javascripts/lib/mapbox-gl-3.6.0.css")' rel="stylesheet"/>
    <link href='@routes.Assets.at("stylesheets/userProfile.css")' rel="stylesheet"/>
    <link href='@routes.Assets.at("stylesheets/choropleth.css")' rel="stylesheet"/>
           
    
    @if(!admin.isDefined) {
        <script type="text/javascript" src='@routes.Assets.at("javascripts/PSMap/build/PSMap.js")'></script>
        <script type="text/javascript" src='@routes.Assets.at("javascripts/Progress/build/Progress.js")'></script>
        <script type="text/javascript" src='@routes.Assets.at("javascripts/common/detectMobileBrowser.js")'></script>
        
        <script>
            $(document).ready(function () {
                i18next.use(i18nextHttpBackend).init({
                    backend: { loadPath: '/assets/locales/{{lng}}/{{ns}}.json' },
                    fallbackLng: 'en',
                    ns: ['dashboard', 'common', 'labelmap'],
                    defaultNS: 'dashboard',
                    lng: "@lang.code",
                    debug: false
                }, function(err, t) {
                    Progress(_, $, '@user.get.role');
    
                    const achievementTracker = new AchievementTracker();
                    achievementTracker.updateBadgeAchievementGrid(
                        @MissionTable.countCompletedMissions(user.get.userId, includeOnboarding = true, includeSkipped = false),
                        @auditedDistance,
                        @LabelTable.countLabels(user.get.userId),
                        @LabelValidationTable.countValidations(user.get.userId)
                    );
    
                    MistakeCarousel();
                });
    
                $('[data-toggle="tooltip"]').tooltip();
                $('[id="edit-org-dropdown"]').popover({
                    trigger: 'manual',
                    html: true,
                    animation: false
                }).on('mouseenter', function() {
                    var _this = this;
                    $(this).popover('show');
                    $('#email-link').on('click', function(e) {
                        $.ajax({
                            async: false,
                            contentType: 'application/json; charset=utf-8',
                            url: '/userapi/logWebpageActivity',
                            type: 'post',
                            data: JSON.stringify('Click_module=email_link'),
                            dataType: 'json'
                        });
                    });
                    $('.popover').on('mouseleave', function() {
                        $(_this).popover('hide');
                    });
                }).on('mouseleave', function() {
                    var _this = this;
                    setTimeout(function() {
                        if (!$('.popover:hover').length) {
                            $(_this).popover('hide');
                        }
                    }, 300);
                });
                $('[class="put-org-container"]').popover();
            });
        </script>
    } else {
        <script type="text/javascript" src='@routes.Assets.at("javascripts/lib/d3-3.5.6.js")'></script>
        <script type="text/javascript" src='@routes.Assets.at("javascripts/lib/jquery.dataTables.min.js")'></script>
        <script type="text/javascript" src='@routes.Assets.at("javascripts/lib/dataTables.bootstrap.min.js")'></script>
        <script type="text/javascript" src='@routes.Assets.at("javascripts/Admin/build/Admin.js")'></script>
        <script type="text/javascript" src='@routes.Assets.at("javascripts/common/UtilitiesSidewalk.js")'></script>
        <script type="text/javascript" src='@routes.Assets.at("javascripts/common/UtilitiesPanomarker.js")'></script>
        <script type="text/javascript" src='@routes.Assets.at("javascripts/common/Panomarker.js")'></script>
        <script type="text/javascript" src='@routes.Assets.at("javascripts/SVValidate/src/util/PanoProperties.js")'></script>
        <script type="text/javascript" src='@routes.Assets.at("javascripts/PSMap/build/PSMap.js")'></script>
        <script type="text/javascript" src='@routes.Assets.at("javascripts/common/timestampLocalization.js")'></script>
        
        <script type="text/javascript">
            updateTimestamps("@lang.code");
        </script>
        
        <script src='//cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.1/js/bootstrap-datepicker.min.js'></script>
        <link href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.1/css/bootstrap-datepicker.min.css' rel='stylesheet' />
        
        <link href='@routes.Assets.at("stylesheets/admin.css")' rel="stylesheet"/>
        <link href='@routes.Assets.at("stylesheets/dataTables.bootstrap.min.css")' rel="stylesheet"/>
        
        <script>
            $(document).ready(function () {
                i18next.use(i18nextHttpBackend).init({
                    backend: { loadPath: '/assets/locales/{{lng}}/{{ns}}.json' },
                    fallbackLng: 'en',
                    ns: ['dashboard', 'common', 'labelmap'],
                    defaultNS: 'dashboard',
                    lng: "@lang.code",
                    debug: false
                }, function(err, t) {
                    AdminUser('@userDB.map(_.username).getOrElse("No Username")', '@userDB.map(_.userId).getOrElse("No ID")', @UserRoleTable.getCommunityService(userDB.map(_.userId).map(UUID.fromString).getOrElse(UUID.randomUUID())));
                    $('#label-table').dataTable();
                });
            });
        </script>
    }

}
